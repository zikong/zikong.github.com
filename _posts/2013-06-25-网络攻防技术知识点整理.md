---
layout: post
title:  网络攻防技术知识点整理
date:   2013-06-25 00:50:00
categories: [网络攻防]
tags: [网络攻防]
---

#网络攻防技术

##网络信息收集技术

###踩点
对某组织或足迹进行有计划有步骤踩点，收集整理一份关于其的信息安防现在的完整剖析图

	1. 因特网信息
	2. 内联网信息
	3. 远程访问系统
	4. 外连网信息

搜索引擎的使用

	1. 目标信息一定含有的关键字(⽤用“ ”连起来)
	2. 目标信息不能含有的关键字(用“-”去掉)
	3. 目标信息可能含有的关键字(用“OR”连接)
	4. 支持“＊”作为通配符
	5. “＋”强制搜索关键词
	6. “site：” 限制网站
	7. “link：” 查找谁引用了你的链接
	8. “filetype：”查找特定文件
	9. “allintitle” 表示标题中含有所有的关键字
	10. “intitle” 标题含有第一个关键字
	11. “info” 网站摘要信息

网络上的Whois服务

whois就是一个用来查询域名是否已经杯注册，以及注册域名的详细信息的数据库，使用43号端口。

DNS服务

##网络扫描

* 主机扫描
	
	检查主机是否活跃
	主要方式：1.传统的ICMP 2.ACK ping 3.SYN ping 4.UDP ping
	防御：考虑对ICMP通信的过滤策略

* 端口扫描
	
	连接目标主机的TCP和UDP端口，确定那些服务正在运行即处于监听状态的过程。
	TCP/UDP(1-64K),运行网络应用服务
	由IANA/ICANN负责分配
	目的：更加了解说管理的网络状况，找出没有必要开放的端口并关闭，这是保证业务网络安全的第一步，

	TCP连接扫描
	
		调⽤用connect() socket函数连接⺫⽬目标端⼝口 
		开放端⼝口:完成完整的TCP三次握⼿手(SYN,SYN|ACK, ACK),timeout/RST 
		关闭端⼝口:SYN, RST
		优势&弱势:⽆无需特权⽤用户权限可发起,⺫⽬目标 主机记录⼤大量连接和错误信息,容易检测
		
	SYN扫描
	
		半开扫描(half-open scanning)
		开放端⼝口:攻击者SYN,⺫⽬目标主机SYN|ACK,攻击者⽴立即反馈RST包关闭连接
		关闭端⼝口:攻击者SYN,⺫⽬目标主机RST
		优势&弱势:⺫⽬目标主机不会记录未建⽴立连接

* 扫描实践之NAMP
	
		命令格式 nmap [Scan Type...] [Options] {target specification}
		即: nmap[<扫描类型> ...][<选项> ]{ < 扫描⺫⽬目标说明> }
	端口在NMAP里的六个状态:
		unfiltered(未被过滤的) 未被过滤状态意味着端口可访问，但Nmap不能确定它是开放还是关闭
		open|filtered(开 放或者被过滤的)当无法确定端口是开放还是被过滤的，Namp就把该端口划分成这种状态。开放的端口不响应就是一个例子。 没有响应也可能意味着报文过滤器丢弃了探测报文或者它引发的任何响应。因此Nmap无法确定该端口是开放的还是被过滤的。UDP，IP协 议，FIN，Null和Xmas扫描可能把端口归入此类
		closed|filtered(关闭或者未被过滤的) 该状态用于Nmap不能确定端口是关闭的还是被过滤的。它只可能出现在IPID Idle扫描中

##网络嗅探技术

* 网络嗅探的胃寒与作用
		
		攻击者：内网渗透技术窃取机密信息，为发起进一步攻击收集信息
		防御者：管理员可以用来监听网络的流量情况，定位网络故障，为网络入侵检测系统提供底层数据来源基础
		其他作用：开发网络应用的程序员可以监视程序的网络情况
* 以太网的工作原理
		载波侦听/冲突检测(CSMA/CD: 802.3, carrier sense multiple access with collision detection)技术
			载波侦听：每个站点，同等的权利，发送前监听信道是否空闲，
				如果空闲，就传输自己的数据
				如果信道被占用，就等待信道空闲
			冲突检测则是为了防止发生两个站点同时监测到网络没有被使用时而产生冲突
		采用了CSMA/CD技术，使用了广播机制，所以，所有在同一媒介信道上连接的工作站都可以看到网络上传递的数据

* 网卡的工作模式

		网卡的MAC地址(48位)
			ARP引入
			MAC地址相对固定且唯一
		正常情况下，网卡应该只接收这样的包
			MAC地址与自己相匹配的
			包/组播包
		两种接收模式
			混杂模式：不管数据帧中的目的地址，所有都接收
			非混杂模式：只接收目的地址相匹配的数据帧，以及广播数据包(和组播数据包)
		为了监听，设置为混杂模式	
* 共享式网络和交换式网络
		
		共享式网络
			通过Hub(集线器)连接
			总线方式: 通过网络的所有数据包 			发往每一个主机
			能够嗅探整个Hub上全部网络流量
		交换式网络
			通过Switch(交换机)连接
			由交换机构造一个“MAC地址-端口”映射表
			发送包的时候，只发到特定端口上只能监听同一端口上流量
* 交换式网络中的嗅探攻击
		MAC地址洪泛攻击
			向交换机发送大量虚构MAC地址和IP地址数据包
			致使交换机“MAC地址-端口映射表”溢出
			交换机切换入所谓的“打开失效”模式-“共享式”
		MAC欺骗
			假冒所要监听的主机网卡，将源MAC地址伪造成目标主机的MAC地址
			交换机不断地更新它的“MAC地址-端口映射表”
			交换机就会将本应发送给目标主机的数据包发送给攻击者
		ARP欺骗
			利用IP地址与MAC地址之间进行转换时的协议漏洞
			ARP无状态性
##欺骗与会话劫持
* 网络安全属性
		机密性，完整性，可用性，真实性，不可抵赖性

* ARP欺骗

	1. ARP协议工作原理
			
			将网络主机的IP地址解析成其MAC地址
				①每台主机设备上都拥有一个ARP缓存(ARP Cache)
				②检查自己的ARP缓存，有，直接映射，无，广播ARP请求包
				③检查数据包中的目标IP地址是否与自己的IP地址一致，如一致，发送ARP响应，告知MAC地址
				④源节点在收到这个ARP响应数据包后，将得到的目标主机IP地址和MAC地址对映射表项添加到自己的ARP缓存中	
				ARP欺骗：发送伪造ARP消息，对特定IP所对应的MAC地址进行假冒欺骗，从而达到恶意目的
	2. ARP欺骗程序实现
			ARPPACKET  ARPPacket;
			ARPPacket.ehhdr.eh_type=htons(0x0806);  //数据类型ARP请求或应答
			ARPPacket.arphdr.arp_hrd = htons(0x0001); //硬件地址为0x0001表示以太网地址
			ARPPacket.arphdr.arp_pro = htons(0x0800); //协议类型字段为0x0800表示IP地址
			ARPPacket.ehhdr.eh_dst=0xAAAAAAAAAAAA   //A机的MAC
			ARPPacket.ehhdr.eh_src=0xCCCCCCCCCCCC    //C机的源MAC
			ARPPacket.arphdr.arp_hln = 6;                  
			ARPPacket.arphdr.arp_pln = 4;
			ARPPacket.arphdr.arp_op = htons(0x0002);      //ARP应答值为2
			ARPPacket.arphdr.arp_spa = 0xCCCCCCCCCCCC //伪造的MAC，在这里C机用的自己的
			ARPPacket.arphdr.arp_tha = 0xAAAAAAAAAAAA //
			ARPPacket.arphdr.arp_spa =inet_addr("192.168.1.172");  //伪造B的IP地址
			ARPPacket.arphdr.arp_tpa = inet_addr("192.168.1.200");   //目标A的IP地址
			//把要发送的数据保存在一个缓冲区szPacketBuf中，到时候只要把szPacketBuf的数据发送出去就可以了。
			memcpy(szPacketBuf, (char*)&ARPPacket, sizeof(ARPPacket));
			//要发送数据，首先得打开一个适配器
			PacketGetAdapterNames((char*)AdapterName, &AdapterLength); //取得所有适配器的名字.
			LPPACKET lpAdapter =PacketOpenAdapter((LPTSTR) AdapterList[0]); //打开第一块适配器
			//下标是从0开始的。指向一个初始化的ADAPTER Object
			lpPacket = PacketAllocatePacket(); //为_PACKET结构配内存
			PacketInitPacket(lpPacket, szPacketBuf, 60); //packet结构中的buffer设置为传递的szPacketBuf指针
			PacketSetNumWrites(lpAdapter, 2); //设置发送次数为2次
			//一切就绪发送：
			PacketSendPacket(lpAdapter, lpPacket, TRUE); //通过打开的适配器把			szPacketBuf的数据发送出去。
			PacketFreePacket(lpPacket);         //释放_PACKET结构
			PacketCloseAdapter(lpAdapter);      //关闭适配器
			然后 在A机上的运行中输入arp -a 会发现原来的 192.168.1.172 BB-BB-BB-BB-BB-BB
			变成 192.168.1.172 CC-CC-CC-CC-CC-CC 了
	3. ARP欺骗攻击防范措施
			静态绑定关键主机的IP地址与MAC地址映射关系
				网关/关键服务器
				“arp-s IP地址MAC地址”
			使用相应的ARP防范工具
				ARP防火墙
			使用VLAN虚拟子网细分网络拓扑 			加密传输数据以降低ARP欺骗攻击的危害后果
##ICMP相关攻击

* ICMP定义
		ICMP（Internet Control Message Protocol ）
		RFC 792中定义了ICMP协议 ，ICMP 在 IPv6 定义中重新修订
		IP提供不可靠和无连接的数据传送，ICMP正是为了补偿IP的缺陷而设计。
		ICMP协议设计的最初目的主要是用于IP层的差错报告，由路由器或信宿以一对一的模式向信源报告传输错误的原因。
		随着网络的发展，检测和控制功能逐渐被引入到ICMP协议中，使得ICMP协议不仅用于传输差错报告，而且大量用于传输控制报文。
* ICMP的功用
		ICMP报文提供针对网络层的错误诊断、拥塞控制、路径控制和路由器或主机信息的查询服务四项功能.
* ICMP报文
		1. ICMP报文由首部和数据段组成。首部为定长的8个字节，前4个字节是通用部分，后4个字节随报文类型的不同有所差异。报文中类型字段和代码字段来决定不同类型。
		2. ICMP 报文分为查询报文和差错报文两类。

* ICMP差错报文
		
		ICMP的主要责任之一是报告错误。ICMP使用源IP地址将差错报文发送给数据报的源端。一共有五种差错可处理：目的端不可达 超时 参数问题 源端抑制 改变路由。

* ICMP的限定

		ICMP差错报告具有以下特点
  			1. 只报告差错，但不负责纠正错误，纠错工作留给高层协议去处理。
  			2. 发现出错的设备只向信源报告差错。
  			3. 差错报告作为一般数据传输，不享受特别优先权和可靠性。
  			4. 产生ICMP差错报告的同时，会丢弃出错的IP数据报。
  			
